# DuitQ - Chatbot WhatsApp Pencatat Keuangan

![Node.js](https://img.shields.io/badge/Node.js-18.x-green?style=for-the-badge&logo=node.js)
![Supabase](https://img.shields.io/badge/Supabase-Backend-green?style=for-the-badge&logo=supabase)
![WhatsApp](https://img.shields.io/badge/whatsapp--web.js-WhatsApp-brightgreen?style=for-the-badge&logo=whatsapp)

Sebuah chatbot WhatsApp sederhana yang berfungsi sebagai asisten pencatat keuangan pribadi. Chatbot ini terintegrasi dengan Supabase sebagai backend untuk menyimpan data pengguna, kategori, transaksi, dan log aktivitas.

Tampilan di Whatsapp Desktop v

![Bantuan](https://github.com/fahroediin/whatsapp-cashflow-bot/blob/main/images/bantuan.png)

![Cek Cashflow Harian](https://github.com/fahroediin/whatsapp-cashflow-bot/blob/main/images/cek%20harian.png)
---

## âœ¨ Fitur Utama

- **ğŸ“ Pencatatan Transaksi Fleksibel**: Catat pemasukan dan pengeluaran dengan format sederhana dan parsing nominal yang cerdas (misal: `15000`, `15rb`, `1.5jt`).
- **ğŸ“Š Laporan Keuangan Dinamis**: Dapatkan ringkasan dan detail transaksi untuk periode harian, mingguan, bulanan (termasuk bulan-bulan sebelumnya), dan tahunan.
- **ğŸ’° Saldo Kumulatif**: Laporan harian menampilkan saldo kumulatif untuk memberikan konteks keuangan total.
- **âœï¸ Edit Transaksi**: Fitur interaktif untuk mengubah nominal atau catatan dari transaksi terakhir yang salah diinput.
- **ğŸ—‘ï¸ Hapus Transaksi**: Fitur interaktif untuk menghapus transaksi dari daftar bulan berjalan.
- **ğŸ›¡ï¸ Validasi Saldo**: Mencegah pencatatan pengeluaran jika saldo tidak mencukupi.
- **ğŸ“œ Log Aktivitas**: Semua interaksi pengguna dicatat di database untuk keperluan pemantauan.
- **ğŸ‘¤ Manajemen User Otomatis**: Pengguna baru otomatis terdaftar saat pertama kali berinteraksi.
- **ğŸ¨ UI Emoji**: Penggunaan emoji yang tematik untuk meningkatkan pengalaman pengguna.
---

## ğŸ”§ Teknologi yang Digunakan

- **Backend**: Node.js
- **Interaksi WhatsApp**: `whatsapp-web.js`
- **Database**: Supabase (PostgreSQL)
- **Manajemen Kunci API**: `dotenv`

---

## ğŸš€ Panduan Instalasi dan Setup

Ikuti langkah-langkah berikut untuk menjalankan bot ini di lingkungan lokal Anda.

### 1. Prasyarat

- [Node.js](https://nodejs.org/) (disarankan versi 18.x atau lebih baru)
- Akun [Supabase](https://supabase.com/) (gratis)

### 2. Kloning Repository

```bash
git clone https://github.com/fahroediin/whatsapp-cashflow-bot.git
cd whatsapp-cashflow-bot
```

### 3. Instalasi Dependensi

Jalankan perintah berikut di terminal:

```bash
npm install
```

### 4. Setup Supabase

Ini adalah langkah paling penting. Anda perlu membuat tabel dan mengatur kebijakan keamanan di Supabase.

1.  Masuk ke [Dashboard Supabase](https://app.supabase.com/) dan buat proyek baru.
2.  Setelah proyek dibuat, pergi ke **SQL Editor**.
3.  Salin **seluruh kode SQL di bawah ini** dan jalankan di SQL Editor.

<details>
<summary><strong>Klik untuk melihat Kode SQL Lengkap</strong></summary>

```sql
-- 1. Membuat Tabel Kategori
CREATE TABLE kategori (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nama_kategori TEXT NOT NULL UNIQUE,
  tipe TEXT NOT NULL CHECK (tipe IN ('INCOME', 'EXPENSE'))
);
COMMENT ON TABLE kategori IS 'Menyimpan daftar kategori transaksi.';

-- 2. Membuat Tabel Users
CREATE TABLE users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  nama TEXT,
  nomer_whatsapp TEXT NOT NULL UNIQUE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
COMMENT ON TABLE users IS 'Menyimpan data pengguna chatbot.';

-- 3. Membuat Tabel Transaksi
CREATE TABLE transaksi (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  id_user UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  id_kategori BIGINT NOT NULL REFERENCES kategori(id),
  nominal NUMERIC(15, 2) NOT NULL,
  catatan TEXT,
  tanggal TIMESTAMPTZ DEFAULT NOW()
);
COMMENT ON TABLE transaksi IS 'Mencatat semua transaksi pemasukan dan pengeluaran.';

-- 4. Membuat Tabel Log Aktivitas
CREATE TABLE log_aktivitas (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  id_user UUID REFERENCES users(id) ON DELETE SET NULL,
  user_wa_number TEXT,
  aktivitas TEXT NOT NULL,
  detail TEXT,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);
COMMENT ON TABLE log_aktivitas IS 'Mencatat semua aktivitas yang dilakukan pengguna melalui chatbot.';

-- 5. Memasukkan Data Awal untuk Kategori
INSERT INTO kategori (nama_kategori, tipe) VALUES
('gaji', 'INCOME'),
('pemasukan', 'INCOME'),
('makanan', 'EXPENSE'),
('minuman', 'EXPENSE'),
('jajan', 'EXPENSE'),
('belanja', 'EXPENSE');

-- 6. Mengaktifkan Row Level Security (RLS)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE kategori ENABLE ROW LEVEL SECURITY;
ALTER TABLE transaksi ENABLE ROW LEVEL SECURITY;
ALTER TABLE log_aktivitas ENABLE ROW LEVEL SECURITY;

-- Kebijakan untuk tabel 'users'
CREATE POLICY "Users can view and manage their own data" ON users FOR ALL
USING (auth.uid() = id);

-- Kebijakan untuk tabel 'kategori'
CREATE POLICY "All authenticated users can view categories" ON kategori FOR SELECT
USING (auth.role() = 'authenticated');

-- Kebijakan untuk tabel 'transaksi'
CREATE POLICY "Users can manage their own transactions" ON transaksi FOR ALL
USING (auth.uid() = id_user)
WITH CHECK (auth.uid() = id_user);

-- Kebijakan untuk tabel 'log_aktivitas' (Hanya bisa diakses dari server)
CREATE POLICY "Service role can access logs" ON log_aktivitas FOR ALL
USING (false); -- Blokir semua akses kecuali via service_role_key
```

</details>

### 5. Konfigurasi Lingkungan

1.  Buat file baru bernama `.env` di direktori utama proyek.
2.  Salin konten dari file `.env.example` (jika ada) atau salin format di bawah ini ke dalam file `.env` Anda.

    ```env
    # URL proyek Supabase Anda
    SUPABASE_URL="https://xxxxxxxxxxxxxxxxxxxx.supabase.co"

    # SERVICE_ROLE_KEY Anda. Kunci ini bisa melewati RLS. Jaga kerahasiaannya!
    SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxxxxxxxxxxx.xxxxxxxxxxxxx"
    ```

3.  Dapatkan nilai `SUPABASE_URL` dan `SUPABASE_SERVICE_ROLE_KEY` dari dashboard Supabase Anda di **Project Settings > API**.
    > **PENTING:** Jangan pernah membagikan `SERVICE_ROLE_KEY` Anda atau menyimpannya di repositori publik. Pastikan file `.env` sudah ada di dalam `.gitignore`.

### 6. Menjalankan Bot

1.  Jalankan bot dengan perintah:
    ```bash
    node index.js
    ```
2.  Buka terminal. Sebuah QR Code akan muncul.
3.  Scan QR Code tersebut menggunakan aplikasi WhatsApp di ponsel Anda (**Setelan > Perangkat Tertaut > Tautkan Perangkat**).
4.  Setelah berhasil, akan muncul pesan "Client sudah siap dan terhubung ke WhatsApp!". Bot Anda siap digunakan.

---

## ğŸ“š Cara Penggunaan (Perintah Bot)

Interaksi dengan bot dilakukan melalui perintah-perintah berikut:

| Perintah | Format | Contoh Penggunaan |
| :--- | :--- | :--- |
| **Sapaan** | `halo` / `pagi` | `halo` |
| **Bantuan** | `bantuan` | `bantuan` |
| **Catat Transaksi** | `kategori nominal [catatan]` | `makanan 25000 sate ayam` |
| **Cek Laporan** | `cek <periode>` | `cek harian` / `cek bulanan` |
| **Edit Transaksi** | `edit` / `ubah` | `edit` |

---

## ğŸ“‚ Struktur Proyek

```
.
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ commandHandler.js    # Logika untuk setiap perintah (cek, edit, hapus, reset)
â”‚   â”œâ”€â”€ interactiveHandler.js # Logika untuk step-by-step interaktif
â”‚   â””â”€â”€ transactionHandler.js  # Logika untuk mencatat transaksi baru
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ currency.js          # Fungsi formatCurrency dan parseNominal
â”‚   â””â”€â”€ db.js                # Fungsi terkait Supabase (log, getUser, dll)
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ index.js                 # File utama, sebagai "router" dan inisialisasi client
â”œâ”€â”€ package.json
â””â”€â”€ supabaseClient.js
```